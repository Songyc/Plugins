<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>myCalendar</title>
	<style>
	
	/*.calRow {
		width: 500px;
		line-height: 20px;
	}*/
	.myFirstCal {
		padding: 5px;
		border: 1px solid #ccc;
	}
	.myCalendar + .myCalendar {
		margin-left: 5px;
	}
	.calRow.dayRow {
		border-top: #ececec;
	}
	.dateRow {
		border-left: #ececec;
	}
	.myCal-day {
		/*width: 13%;*/
		border-right: #ececec;
		border-bottom: #ececec;
		display: table-cell;
	}
	.myCal-year, .myCal-month {
		width: 49%;
	}
	.myCalendar {
		line-height: 25px;
		width: 49%;
	}
	.myCal-nextMonth {
		position: absolute; 
		top: 5px; 
		width: 8px; 
		height: 24px;
		right: 12px;
	}
	.right-border, .left-border {
		border-left: 8px solid #fff;
		border-top: 8px solid transparent; 
		border-bottom: 8px solid transparent;
		position: absolute; 
		width: 100%;
	}
	.left-border {
		border-left: 8px solid #2b9dfd;
		left: -4px;
	}
	.myCal-dateRows {
		border-left: 1px solid #ccc;
	}
	.dayRow, .myCal-dateRows, .myCal-header {
		width: 300px;
	}
	/*自定义样式*/
	.dpIB {
		display: inline-block;
	}
	.textC {
		text-align: center;
	}
	.textR {
		text-align: right;
	}
	.textL {
		text-align: left;
	}
	.colorFF {
		color: #fff;
	}
	.color00 {
		color: #000;
	}
	.colorCC {
		color: #ccc;
	}
	.colorEC {
		color: #ececec;
	}
	.bgBlue {
		background: #2b9dfd;
	}
	.bgOrange{
		background: #ff6001;
	}
	.psR {
		position: relative;
	}
	.borderRBCC {
		border-right: 1px solid #ccc;
		border-bottom: 1px solid #ccc;
	}
	.borderRBBlue {
		border-right: 1px solid #2b9dfd;
		border-bottom: 1px solid #2b9dfd;
	}
	.borderLBlue {
		border-left: 1px solid #2b9dfd;
	}
	.borderAA {
		border: 1px solid #aa6f29;
	}
	.dpT {
		display: table;
	}
	.dpTR {
		display: table-row;
	}
	.dpTC {
		display: table-cell;
	}
	.flL {
		float: left;
	}
	.flR {
		float: right;
	}
	</style>
</head>
<body>
	<input type = "button" value = "团期" class = "myCal-Button" onclick = 'myCal_init({"startTime": "2014-11", "endTime": "2015-02"});'/>
	<div class = "myCalendar" id = "myCalendar">
		<!-- <div class = "myCal-header bgBlue" >
			<div class = "myCal-year dpIB textR" style = "width: 48%;">2014</div>
			<div class = "myCal-month dpIB psR" style = "width: 48%;">
				<span class = "myCal-month-text">12月</span>
				<div class = "myCal-nextMonth">
					<div class = "right-border"></div>
					<div class = "left-border"></div>
				</div>
			</div>
		</div> -->
		<!-- <table>
			<tr>
				<td>1</td>
				<td>
					<div>1212</div>
					<div>1212</div>
					<div>1212</div>
				</td>
				<td>1</td>
			</tr>
			<tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
		</table> -->
		<!-- <div style = "display: table; width: 300px;">
			<div style = "display: table-row; width: 300px;" >
				<div style = "display: table-cell;height: 100px;line-height: 100px;">121</div>
				<div style = "display: table-cell">121</div>
				<div style = "display: table-cell">121</div>
			</div>
		</div> -->
		<!-- <div style = "width: 500px; font-size:0;">
			<div style = "display: inline-block; font-size: 20px;width: 10%;">1</div>
			<div style = "display: inline-block; font-size: 20px;width: 10%;">1</div>
			<div style = "display: inline-block; font-size: 20px;width: 10%;">1</div>
			<div style = "display: inline-block; font-size: 20px;width: 10%;">1</div>
		</div> -->
		<div class="myCal-day dpIB borderRBCC dpTC" style = "width: 100px;">
			<div class = "myCal-day-text">31</div>
			<div class = "myCal-day-child dpT" >
				<div class = "myCal-day-child-icon colorFF dpTC borderAA bgOrange" style = "background: #ff6001; width:20px; height: 100%; ">儿</div>
				<div class = "myCal-day-child-text dpTC ">1212</div>
			</div>
			<div class = "myCal-day-men dpT">
				<div class = "myCal-day-men-icon colorFF borderAA bgOrange dpTC" style = "background: #ff6001; width: 20px; height: 100%;">成</div>
				<div class = "myCal-day-men-text dpTC">1212</div>
			</div>
		</div>
	</div>
	
</body>
<script>
		var myCalendar = {
			newDate: new Date(),
			seconds: new Date().getSeconds(),	//时
			minutes: new Date().getMinutes(),	//分
			Hours: new Date().getHours(),		//秒
			days: new Date().getDay(),			//星期
			date: new Date().getDate(),		//日
			month: new Date().getMonth(),		//月
			year: new Date().getFullYear(),		//年
			// 
			_D_date: new Date().getDate(),				//取日
			_M_month: new Date().getMonth() + 1,		//取月
			// _M_month2: new Date().getMonth() + 2,
			_Y_year: new Date().getFullYear(),			//取年
			// _Y_year2: new Date().getFullYear(),			//取年
			_Max_year: null,
			_Max_month: null,
			params: {
		 		"startTime": "",
		 		"endTime": "",
		 		
		 	},
			// 判断润年
		 	isLeap: function () {
		 		var _year = this._Y_year;
		 		if(_year % 4 === 0 && _year % 100 > 0) {
		 			return true ;
		 		}
		 		if(_year % 400 === 0 && _year % 3200 > 0) {
		 			return true ;
		 		}
		 		return false ;
		 	},
		 	// 获取月的天数
		 	dayLen: function (month) {
		 		var _month = month ;
		 		if(_month === 2) {
		 			if(this.isLeap()) return 28;
		 			return 29;
		 		}
		 		if(_month < 8 && _month % 2 === 1) {
		 			return 31;
		 		}
		 		if(_month >= 8 && _month % 2 === 0) {
		 			return 31;
		 		}
		 		return 30 ;
		 	},
		 	// 年月
		 	yearMonth: function (thisMonth) {
		 		var _this = this;
		 		var str = "";
		 		str += '<div class = "myCal-header bgBlue colorFF borderLBlue" ><div class = "myCal-year dpIB textR">' + _this._Y_year +'</div><div class = "myCal-month dpIB psR"><span class = "myCal-month-text">' + thisMonth +'月</span><div class = "myCal-nextMonth"><div class = "right-border"></div><div class = "left-border"></div></div></div></div>';
		 		return str ;
		 	},
		 	// 自动适应
		 	widthfit: function () {
		 		var _this = this;
		 		var myCalheader = document.getElementsByClassName("myCal-header")[0];
		 	},
		 	// 把字变灰
		 	grayDate: function (thisMonth) {
		 		var _this = this;
		 		var	len = _this.dayLen(_this._M_month);
		 		var firstDay = (new Date(_this._Y_year, thisMonth - 1, 1)).getDay();
		 		var aDays = _this.getElementsByClassName("myCal-day");
		 		var start = 0 ;
		 		var arr = [];
		 		// var d 
		 		for(var i = 1; i <= 6; i++) {
		 			for(var j = 0; j < 7; j ++) {
		 				start ++;
		 				var fill = start - firstDay;
		 				if(fill <= 0 || fill >= len -1) {
		 					arr.push(start);
		 				}
		 			}
		 		} 	
		 		console.log(arr);
		 		for(var i = 7; i <= aDays.length; i++) {
		 			for(var j = 0; j < arr.length; j++) {
		 				if(arr[j] == i) {
		 					aDays[i].style.color = "red";
		 				}
		 			}
		 		}
		 	}, 
		 	// 儿童成人
		 	childMen: function (date, chlid, men) {
		 		var _this = this;
		 		var str = "" ;
		 		str += '<div class = "myCal-day dpIB borderRBCC dpTC">' + '<div class = "myCal-day-text">' + date + '</div><div class = "myCal-day-child dpT" ><div class = "myCal-day-child-icon colorFF dpTC borderAA bgOrange" style = "background: #ff6001; width:20px; height: 100%; ">儿</div><div class = "myCal-day-child-text dpTC ">'+chlid+'</div></div><div class = "myCal-day-men dpT"><div class = "myCal-day-men-icon colorFF borderAA bgOrange dpTC" style = "background: #ff6001; width: 20px; height: 100%;">成</div><div class = "myCal-day-men-text dpTC">'+men+'</div></div>' +'</div>';
		 		return str;
		 	},	
		 	// 加载日历
		 	loadCalendar: function (thisMonth) {
		 		var _this = this;
		 		var	len = _this.dayLen(_this._M_month);
		 		var firstDay = (new Date(_this._Y_year, thisMonth - 1, 1)).getDay();
		 		var arr = [];
		 		var _N_Day = 0;
		 		var start = 0;
		 		var str = "";

		 		// 日期排序
		 		for (var i = 0;i < 7; i++) {
		 			arr[i] = [];
		 			for(var j = 0 ;j < 7; j++) {
		 				if(i == 0) {
		 					if(j == 0) {
		 						str += '<div class = "calRow dayRow bgBlue textC colorFF dpT borderLBlue">';
		 					}
		 					arr[i][j] = "日一二三四五六七".charAt(j);
		 					str += '<div class = "myCal-day dpIB borderRBBlue dpTC">' + arr[i][j] +'</div>';
		 					if(j == 6) {
		 						str += '</div>';
		 					}
		 				}else{
		 					start ++;
		 					var fill = start - firstDay;
		 					if(fill > 0 && fill < len + 1) {
		 						if(j == 0) {
		 							if( i == 1) {
		 								str += '<div class = "myCal-dateRows dpT">';
		 							}
			 						str += '<div class = "calRow dateRow dpTR">';
			 					}
		 						arr[i][j] = fill;
		 						str += _this.childMen(arr[i][j], 12, 12);
		 						if(j == 6) {
			 						str += '</div>';
			 					}
		 					}else{
		 						// 上个月
		 						if(fill <= 0) {
		 							var lastLen = _this.dayLen(_this._M_month - 1);
		 							arr[i][j] = lastLen + fill;
		 							if(j == 0) {
		 								if( i == 1) {
			 								str += '<div class = "myCal-dateRows dpT">';
			 							}
				 						str += '<div class = "calRow dateRow dpTR">';
				 					}
		 							str += _this.childMen(arr[i][j], 12, 12);
		 							if(j == 6) {
				 						str += '</div>';
				 					}
		 						// 下个月
		 						}else if(fill >= len-1){
		 							_N_Day++;
		 							arr[i][j] = _N_Day;
		 							if(j == 0) {
				 						str += '<div class = "calRow dateRow dpTR">';
				 					}
		 							str += _this.childMen(arr[i][j], 12, 12);
		 							if(j == 6) {
		 								if(i == 6) {
		 									str += '</div>';
		 								}
				 						str += '</div>';
				 					}
		 						}
		 					}
		 				}
		 			}
		 		}
		 		return str;
		 	},
		 	// getClass
		 	getElementsByClassName: function (className) {
		 		var _this = this;
		 		if(document.getElementsByClassName) {
		 			return document.getElementsByClassName(className);
		 		}
		 		var arr = [];
		 		var aTag = document.getElementsByTagName("*");
		 		for(var i = 0; i < aTag.length; i++) {
		 			if(aTag[i].className == className) {
		 				arr.push(aTag[i]);
		 			}
		 		}
		 		return arr ;
		 	},
		 	// 判断最后月
		 	isMaxMonth: function () {
		 		var _this = this;
		 		if(_this._Max_month && _this._Max_year) {
		 			// 2015-1:2014:12 2014-12:2014-11
		 			if(+_this._Max_year == +_this._Y_year && +_this._Max_month == +_this._M_month) {
		 				// _this._M_month--;
		 				return true;
		 			}
		 		}
		 	},
		 	// 下一个月
		 	nextMonth: function () {
		 		var _this = this;
		 		if(+_this._M_month == 12) {_this._Y_year++;_this._M_month = 1;}
		 		else{_this._M_month++};
		 	},
		 	hasInit: function () {
		 		var myFirstCal = this.getElementsByClassName("myFirstCal");
		 		if(myFirstCal !== undefined && myFirstCal.length) {
		 			return true;
		 		}
		 		return false;
		 	},
		 	// 封装日历
		 	joinCalendar: function () {
		 		var _this = this;
		 		var _thisMonth = _this._M_month ;
		 		var str = "";
		 		// 如果为截止时间就退回一个月,如果月份为1,则退回去年12月
		 		if(_this.isMaxMonth()) {
		 			if(+_this._M_month == 1) {_this._M_month = 12;_this._Y_year--; } 
		 			else{_this._M_month--;}
		 			str += '<div class = "myCalendar dpIB">' + _this.yearMonth(_this._M_month) + _this.loadCalendar(_this._M_month) + '</div>';
		 		}
		 		// 如果还没到截止时间就加1月
		 		else{
		 			str += '<div class = "myCalendar dpIB">' + _this.yearMonth(_this._M_month) + _this.loadCalendar(_this._M_month) + '</div>';
		 		}
		 		_this.nextMonth();
		 		str += '<div class = "myCalendar dpIB">' + _this.yearMonth(_this._M_month) + _this.loadCalendar(_this._M_month + 1) + '</div>';
		 		return str ;
		 	},
		 	// 设置日期和初始化日历的起始时间和结束时间
		 	startTime: function (time) {
		 		var _this = this;
		 		var objTime = time.split('-');
		 		_this._Y_year = objTime[0];
		 		_this._M_month = objTime[1];
		 	},
		 	endTime: function (time) {
		 		var _this = this;
		 		var objTime = time.split("-");
		 		_this._Max_year = objTime[0];
		 		_this._Max_month = objTime[1];
		 	},
		 	// 初始化参数
		 	initParams: function (obj) {
		 		var _this = this;
		 		// 开始时间
		 		_this.params.startTime = obj.startTime ? obj.startTime : _this.params.startTime ;
		 		// 结束时间
		 		_this.params.endTime = obj.endTime ? obj.endTime : _this.params.endTime ;
		 		// 调用开始时间
		 		if(obj.startTime) {_this.startTime(obj.startTime)};
		 		// 调用结束时间
		 		if(obj.endTime) {_this.endTime(obj.endTime)};
		 	},
		 	init: function (obj) {
		 		var _this = this;
		 		if(obj){_this.initParams(obj); }
		 		var oDiv = document.createElement("div");
				var oDivInner = document.createElement("div");
				oDiv.className = "myFirstCal";
				oDivInner.className = "myFirstCal-inner";
				oDivInner.innerHTML = _this.joinCalendar();
				oDiv.appendChild(oDivInner);
				// 哪里加
				document.body.appendChild(oDiv);
				var nextMonth = _this.getElementsByClassName("left-border")[1];

		 		nextMonth.onclick = function () {
		 			var oDivInner = _this.getElementsByClassName("myFirstCal-inner")[0];
		 			var myCalendar = _this.joinCalendar();
		 			oDivInner.innerHTML = myCalendar;
		 			_this.getElementsByClassName("left-border")[1].onclick = arguments.callee;
		 		}
		 	},
		}
		var oBtn = myCalendar.getElementsByClassName("myCal-Button")[0];
		// myCalendar.init({"startTime": "2014-11", "endTime": "2015-02"});
		var myCal_init = function (obj) {
			var myFirstCal = myCalendar.getElementsByClassName("myFirstCal")[0];
			if(myCalendar.hasInit()) {
				if(myFirstCal.style.display !== "block") {
					myFirstCal.style.display = "block";
				}else{
					myFirstCal.style.display = "none";
				}
			}else{
				myCalendar.init(obj);
				myCalendar.getElementsByClassName("myFirstCal")[0].style.display = "block";
			}
		}
	</script>
</html>